<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [BulmaGés] [Gitorious] Activity: tborras pushed 1	commits to master...
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/bulmages-main/2012-November/index.html" >
   <LINK REL="made" HREF="mailto:bulmages-main%40lists.berlios.de?Subject=Re%3A%20%3D%3Futf-8%3Fb%3FW0J1bG1hR8Opc10%3D%3F%3D%20%5BGitorious%5D%20Activity%3A%20tborras%20pushed%201%0A%09commits%20to%20master...&In-Reply-To=%3C20121125214842.306FA757C9%40steelheart.shortcut.kunder.linpro.no%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <LINK REL="Previous"  HREF="007411.html">
   <LINK REL="Next"  HREF="007415.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[BulmaGés] [Gitorious] Activity: tborras pushed 1	commits to master... </H1>
    <B>Gitorious</B> 
    <A HREF="mailto:bulmages-main%40lists.berlios.de?Subject=Re%3A%20%3D%3Futf-8%3Fb%3FW0J1bG1hR8Opc10%3D%3F%3D%20%5BGitorious%5D%20Activity%3A%20tborras%20pushed%201%0A%09commits%20to%20master...&In-Reply-To=%3C20121125214842.306FA757C9%40steelheart.shortcut.kunder.linpro.no%3E"
       TITLE="[BulmaGés] [Gitorious] Activity: tborras pushed 1	commits to master...">no-reply en gitorious.org
       </A><BR>
    <I>Dom Nov 25 22:48:42 CET 2012</I>
    <P><UL>
        <LI>Mensaje anterior: <A HREF="007411.html">[BulmaGés][BulmaGés - Solicitud #5] (Nueva) OOolib ya no existe en las distribuciones
</A></li>
        <LI>Próximo mensaje: <A HREF="007415.html">[BulmaGés]Algunas propuestas
</A></li>
         <LI> <B>Mensajes ordenados por:</B> 
              <a href="date.html#7412">[ fecha ]</a>
              <a href="thread.html#7412">[ hilo ]</a>
              <a href="subject.html#7412">[ asunto ]</a>
              <a href="author.html#7412">[ autor ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Hello bulmagesmailing,

One of your favorites has a new activity:
------------------------------------------------------------------------
tborras pushed 1 commits to master
master changed from f461e37 to 8fef7b7

View the commit log at <A HREF="https://gitorious.org/bulmages/bulmages/commits">https://gitorious.org/bulmages/bulmages/commits</A>

View the diff online: <A HREF="https://gitorious.org/bulmages/bulmages/commit/f461e3788ed83f0768c0cda272acf2bad96b6147/diffs/8fef7b76317ce82b7a5c246606164cc8684470ff">https://gitorious.org/bulmages/bulmages/commit/f461e3788ed83f0768c0cda272acf2bad96b6147/diffs/8fef7b76317ce82b7a5c246606164cc8684470ff</A>

Diff: 

commit 8fef7b76317ce82b7a5c246606164cc8684470ff
Author: Tomeu Borras &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/bulmages-main">tborras en conetxia.com</A>&gt;
Date:   Sun Nov 25 22:44:13 2012 +0100

    Cambio el sistema de calculo del IRPF.
    Ahora junto al plugin de IVA aparece tambien una opcion de IRPF donde se puede hacer el cambio de IRPF de forma cronologica y los documentos
    buscan el IRPF que les corresponde dependiendo de la fecha del documento.
    
    Este cambio evita que al imprimir facturas antiguas el IRPF aparezca mal y al mismo tiempo evita tener que mantener un campo IRPF en cada documento.
    
    NOTA: Ahora por defecto al crear una empresa aparece puesto el IRPF actual (21%) que no aplican la mayoria de empresas y que debe cambiarse a 0 para no ser aplicado.

diff --git a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/ca/albaran.rml b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/ca/albaran.rml
index 401f95f..799c105 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/ca/albaran.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/ca/albaran.rml
@@ -154,35 +154,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/en/albaran.rml b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/en/albaran.rml
index 401f95f..799c105 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/en/albaran.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/en/albaran.rml
@@ -154,35 +154,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/es/albaran.rml b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/es/albaran.rml
index cdff2b6..5647585 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/es/albaran.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/es/albaran.rml
@@ -99,18 +99,10 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-=======
-
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Descuento/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;% Dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;Total dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-=======
-
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 		&lt;/tr&gt;
 
 &lt;!--LINEAS DESCUENTO--&gt;
@@ -137,13 +129,8 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Comentario/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-=======
 
-			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Comentario/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
@@ -151,13 +138,8 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;[comentalbaran,l]&lt;/para&gt;&lt;/td&gt;
-=======
 
-			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;[comentalbaran,l]&lt;/para&gt;&lt;/td&gt;
-
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
@@ -174,35 +156,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
@@ -217,13 +207,9 @@
 	&lt;/storyPlace&gt;
 
 
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-&lt;storyPlace x=&quot;1cm&quot; y=&quot;1cm&quot; width=&quot;10cm&quot; height=&quot;1cm&quot;&gt;
-&lt;place x=&quot;13.5cm&quot; y=&quot;1cm&quot; width=&quot;10cm&quot; height=&quot;1cm&quot;&gt;
-=======
+
 &lt;storyPlace x=&quot;16cm&quot; y=&quot;0cm&quot; width=&quot;15cm&quot; height=&quot;1cm&quot;&gt;
 &lt;place x=&quot;16cm&quot; y=&quot;0cm&quot; width=&quot;15cm&quot; height=&quot;2.5cm&quot;&gt;
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 &lt;barCode code=&quot;code128&quot; height=&quot;1cm&quot;&gt;ALB [idalbaran] [numalbaran] [refalbaran]&lt;/barCode&gt;
 &lt;/place&gt;
 &lt;/storyPlace&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/fr/albaran.rml b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/fr/albaran.rml
index 401f95f..799c105 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/fr/albaran.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientealbaran/openreports/fr/albaran.rml
@@ -154,35 +154,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechaalbaran]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/factura.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/factura.rml
index 4956143..0c5ca9c 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/factura.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/factura.rml
@@ -161,32 +161,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_copia.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_copia.rml
index d4c06c5..ec91620 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_copia.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_copia.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_grafica.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_grafica.rml
index 03330f2..ecffe5d 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_grafica.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_grafica.rml
@@ -154,32 +154,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_pagada.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_pagada.rml
index 979e16c..89d518a 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_pagada.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/ca/impers_factura_pagada.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/factura.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/factura.rml
index 4956143..0c5ca9c 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/factura.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/factura.rml
@@ -161,32 +161,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_copia.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_copia.rml
index d4c06c5..ec91620 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_copia.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_copia.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_grafica.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_grafica.rml
index 03330f2..ecffe5d 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_grafica.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_grafica.rml
@@ -154,32 +154,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_pagada.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_pagada.rml
index 979e16c..89d518a 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_pagada.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/en/impers_factura_pagada.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/factura.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/factura.rml
index 44c1bbd..630b7be 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/factura.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/factura.rml
@@ -111,10 +111,6 @@
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;% Dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;Total dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 		&lt;/tr&gt;
 
 &lt;!--LINEAS DESCUENTO--&gt;
@@ -165,32 +161,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_copia.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_copia.rml
index d4c06c5..ec91620 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_copia.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_copia.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_grafica.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_grafica.rml
index 03330f2..ecffe5d 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_grafica.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_grafica.rml
@@ -154,32 +154,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_pagada.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_pagada.rml
index 979e16c..89d518a 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_pagada.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/es/impers_factura_pagada.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/factura.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/factura.rml
index 4956143..0c5ca9c 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/factura.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/factura.rml
@@ -161,32 +161,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_copia.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_copia.rml
index d4c06c5..ec91620 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_copia.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_copia.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_grafica.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_grafica.rml
index 03330f2..ecffe5d 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_grafica.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_grafica.rml
@@ -154,32 +154,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_pagada.rml b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_pagada.rml
index 979e16c..89d518a 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_pagada.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientefactura/openreports/fr/impers_factura_pagada.rml
@@ -166,32 +166,40 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;/blockTable&gt;
 					&lt;/td&gt;
 				&lt;/tr&gt;
 				&lt;tr&gt;
 					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
 						&lt;!--TOTALES--&gt;
 							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf/100)::NUMERIC(12,2) AS tmirpf FROM irpf WHERE fechairpf &lt;= '[ffactura]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[tmirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
 							&lt;/tr&gt;
 						&lt;!--END TOTALES--&gt;
 						&lt;/blockTable&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/impers_pedidocliente_urgente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/impers_pedidocliente_urgente.rml
index f07094b..56b51c5 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/impers_pedidocliente_urgente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/impers_pedidocliente_urgente.rml
@@ -165,35 +165,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/pedidocliente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/pedidocliente.rml
index 1b8d2f9..302e929 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/pedidocliente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/ca/pedidocliente.rml
@@ -153,35 +153,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/impers_pedidocliente_urgente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/impers_pedidocliente_urgente.rml
index f07094b..56b51c5 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/impers_pedidocliente_urgente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/impers_pedidocliente_urgente.rml
@@ -165,35 +165,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/pedidocliente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/pedidocliente.rml
index 1b8d2f9..302e929 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/pedidocliente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/en/pedidocliente.rml
@@ -153,35 +153,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/impers_pedidocliente_urgente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/impers_pedidocliente_urgente.rml
index f07094b..56b51c5 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/impers_pedidocliente_urgente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/impers_pedidocliente_urgente.rml
@@ -165,35 +165,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/pedidocliente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/pedidocliente.rml
index 2df0b76..8711b93 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/pedidocliente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/es/pedidocliente.rml
@@ -161,35 +161,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/impers_pedidocliente_urgente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/impers_pedidocliente_urgente.rml
index f07094b..56b51c5 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/impers_pedidocliente_urgente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/impers_pedidocliente_urgente.rml
@@ -165,35 +165,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/pedidocliente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/pedidocliente.rml
index 1b8d2f9..302e929 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/pedidocliente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepedido/openreports/fr/pedidocliente.rml
@@ -153,35 +153,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapedidocliente]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_fproforma.rml b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_fproforma.rml
index 63c25fd..d1f6a6c 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_fproforma.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_fproforma.rml
@@ -163,35 +163,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_solo_totales.rml b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_solo_totales.rml
index 394c65b..7415d6e 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_solo_totales.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_solo_totales.rml
@@ -174,35 +174,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_urgente.rml b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_urgente.rml
index a2e3dee..3077183 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_urgente.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/impers_presupuesto_urgente.rml
@@ -175,35 +175,43 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
 					&lt;/td&gt;
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/presupuesto.rml b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/presupuesto.rml
index 404ca44..a998e11 100644
--- a/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/presupuesto.rml
+++ b/bulmages/bulmafact/plugins/pluginbf_clientepresupuesto/openreports/es/presupuesto.rml
@@ -68,10 +68,6 @@
 
 		&lt;!-- FRAME DE CONTENIDOS --&gt;
 		&lt;frame id=&quot;column&quot; x1=&quot;1cm&quot; y1=&quot;8cm&quot; width=&quot;19cm&quot; height=&quot;14.6cm&quot; /&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 		
 	&lt;/pageTemplate&gt;
 
@@ -101,19 +97,10 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;&lt;u&gt;Descuento/s:&lt;/u&gt;&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-			&lt;td&gt;&lt;/td&gt;
-			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;&lt;u&gt;% Dto:&lt;/u&gt;&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;&lt;u&gt;Total dto:&lt;/u&gt;&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-
-=======
-
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Descuento/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;% Dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2der&quot;&gt;&lt;b&gt;Total dto:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 		&lt;/tr&gt;
 
 &lt;!--LINEAS DESCUENTO--&gt;
@@ -140,13 +127,8 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Comentario/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
 
-=======
-			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;&lt;b&gt;Comentario/s:&lt;/b&gt;&lt;/para&gt;&lt;/td&gt;
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
@@ -154,10 +136,6 @@
 
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;[comentpresupuesto,l]&lt;/para&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
@@ -165,10 +143,7 @@
 		&lt;/tr&gt;
 &lt;!--END QUERY--&gt;
 &lt;!--END IF QUERY--&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
 
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 &lt;!-- IF QUERY = &quot;SELECT vencpresupuesto FROM presupuesto WHERE idpresupuesto=[idpresupuesto] AND vencpresupuesto IS NOT NULL&quot;--&gt;
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
@@ -177,10 +152,6 @@
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;/td&gt;
 		&lt;/tr&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 		&lt;tr&gt;
 			&lt;td&gt;&lt;/td&gt;
 			&lt;td&gt;&lt;para style=&quot;paragrafo2&quot;&gt;Es imprescindible la presentación de este presupuesto para mantener los precios y condiciones.&lt;/para&gt;&lt;/td&gt;
@@ -189,10 +160,6 @@
 			&lt;td&gt;&lt;/td&gt;
 		&lt;/tr&gt;
 &lt;!-- END IF QUERY --&gt;
-&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
-
-=======
-&gt;&gt;&gt;&gt;&gt;&gt;&gt; release
 	&lt;/blockTable&gt;
 
 	
@@ -201,36 +168,45 @@
 			&lt;blockTable style=&quot;total&quot; colWidths=&quot;16.3cm,2.7cm&quot; &gt;
 				&lt;tr&gt;
 					&lt;td colspan=&quot;2&quot;&gt;
-						&lt;blockTable style=&quot;titulo&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Base Imponible:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;I.V.A.%:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Tot I.V.A.:&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;Total:&lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
-				&lt;/tr&gt;
-				&lt;tr&gt;
-					&lt;td&gt;
-						&lt;blockTable style=&quot;contenido&quot; colWidths=&quot;5.5cm, 3.2cm, 1.4cm, 1.75cm, 1.4cm, 1.9cm, 1.15cm&quot; &gt;
-						&lt;!--TOTALES--&gt;
-							&lt;tr&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[bimp]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[tbimp]%&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-								&lt;td&gt;[iva]&lt;/td&gt;
-								&lt;td&gt;  &lt;/td&gt;
-							&lt;/tr&gt;
-						&lt;!--END TOTALES--&gt;
-						&lt;/blockTable&gt;
-					&lt;/td&gt;
+                                                &lt;blockTable style=&quot;titulo&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm, 2.7cm&quot;&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Base Imponible:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;I.V.A.%:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Tot I.V.A.:&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;I.R.P.F.%:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;Tot I.R.P.F.:&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;Total:&lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+                                &lt;/tr&gt;
+                                &lt;tr&gt;
+                                        &lt;td&gt;
+                                                &lt;blockTable style=&quot;contenido&quot; colWidths=&quot;2.65cm, 3.2cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 0.5cm, 1.75cm, 0.5cm, 1.9cm, 1.15cm&quot; &gt;
+                                                &lt;!--TOTALES--&gt;
+                                                        &lt;tr&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[bimp]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[tbimp]%&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;[iva]&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+								&lt;td&gt;&lt;!-- QUERY=&quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot; --&gt;[tasairpf] %&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                                &lt;td&gt;&lt;!-- QUERY=&quot;SELECT (replace('[bimp]',',','.')::NUMERIC(12,2) * tasairpf)::NUMERIC(12,2) AS teirpf FROM irpf WHERE fechairpf &lt;= '[fechapresupuesto]'::DATE AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;--&gt;[teirpf]&lt;!-- END QUERY--&gt;&lt;/td&gt;
+                                                                &lt;td&gt;  &lt;/td&gt;
+                                                        &lt;/tr&gt;
+                                                &lt;!--END TOTALES--&gt;
+                                                &lt;/blockTable&gt;
+                                        &lt;/td&gt;
+
 					&lt;td&gt;
 						&lt;blockTable style=&quot;preciofinal&quot; colWidths=&quot;2.7cm&quot; &gt;
 							&lt;tr&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_ca_ES.sql b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_ca_ES.sql
index bed03d8..6cc45b8 100644
--- a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_ca_ES.sql
+++ b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_ca_ES.sql
@@ -89,9 +89,17 @@ BEGIN
 	        INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 16, '01/01/1973', 4);
 		INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 18, '01/07/2010', 4);
 		INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 21, '01/09/2012', 5.2);
- 	    END IF;
-    END IF;
+	    END IF;
+	END IF;
 	
+
+	SELECT INTO ds * FROM irpf;
+	IF NOT FOUND THEN
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/1901', 15);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2011', 19);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2012', 21);
+	END IF;
+
 	SELECT INTO ds * FROM almacen;
 	IF NOT FOUND THEN
 	    INSERT INTO almacen (codigoalmacen, nomalmacen) VALUES ('000', 'Principal');
diff --git a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_en_US.sql b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_en_US.sql
index 918ef84..2d83531 100644
--- a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_en_US.sql
+++ b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_en_US.sql
@@ -87,9 +87,17 @@ BEGIN
 	    IF FOUND THEN
 	        INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 16, '01/01/1973', 4);
            INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 18, '01/07/2010', 4);
- 	    END IF;
-    END IF;
+	    END IF;
+	END IF;
 	
+
+	SELECT INTO ds * FROM irpf;
+	IF NOT FOUND THEN
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/1901', 15);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2011', 19);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2012', 21);
+	END IF;
+
 	SELECT INTO ds * FROM almacen;
 	IF NOT FOUND THEN
 	    INSERT INTO almacen (codigoalmacen, nomalmacen) VALUES ('000', 'Main');
diff --git a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_es_ES.sql b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_es_ES.sql
index 4c1d8fb..d80bc2d 100644
--- a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_es_ES.sql
+++ b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_es_ES.sql
@@ -89,9 +89,18 @@ BEGIN
 	        INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 16, '01/01/1973', 4);
 		INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 18, '01/07/2010', 4);
 		INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 21, '01/09/2012', 5.2);
- 	    END IF;
-    END IF;
+	    END IF;
+	END IF;
 	
+
+
+	SELECT INTO ds * FROM irpf;
+	IF NOT FOUND THEN
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/1901', 15);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2011', 19);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2012', 21);
+	END IF;
+
 	SELECT INTO ds * FROM almacen;
 	IF NOT FOUND THEN
 	    INSERT INTO almacen (codigoalmacen, nomalmacen) VALUES ('000', 'Principal');
diff --git a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_fr_FR.sql b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_fr_FR.sql
index e7c2c54..cadccf6 100644
--- a/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_fr_FR.sql
+++ b/bulmages/bulmafact/plugins/pluginbf_datosbase/dbmodels/pluginbf_datosbase_fr_FR.sql
@@ -87,9 +87,16 @@ BEGIN
 	    IF FOUND THEN
 	        INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 16, '01/01/1973', 4);
            INSERT INTO tasa_iva (idtipo_iva, porcentasa_iva, fechatasa_iva, porcentretasa_iva) VALUES (bs.idtipo_iva, 18, '01/07/2010', 4);
- 	    END IF;
-    END IF;
+	    END IF;
+	END IF;
 	
+	SELECT INTO ds * FROM irpf;
+	IF NOT FOUND THEN
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/1901', 15);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2011', 19);
+            INSERT INTO irpf (fechairpf, tasairpf) VALUES ('01/01/2012', 21);
+	END IF;
+
 	SELECT INTO ds * FROM almacen;
 	IF NOT FOUND THEN
 	    INSERT INTO almacen (codigoalmacen, nomalmacen) VALUES ('000', 'Principal');
diff --git a/bulmages/bulmafact/plugins/pluginbf_iva/listirpfbase.ui b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfbase.ui
new file mode 100644
index 0000000..2ee5fb6
--- /dev/null
+++ b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfbase.ui
@@ -0,0 +1,157 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
+&lt;ui version=&quot;4.0&quot;&gt;
+ &lt;author&gt;Tomeu Borras Riera&lt;/author&gt;
+ &lt;class&gt;ListIRPFBase&lt;/class&gt;
+ &lt;widget class=&quot;QWidget&quot; name=&quot;ListIRPFBase&quot;&gt;
+  &lt;property name=&quot;geometry&quot;&gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;750&lt;/width&gt;
+    &lt;height&gt;550&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;minimumSize&quot;&gt;
+   &lt;size&gt;
+    &lt;width&gt;750&lt;/width&gt;
+    &lt;height&gt;550&lt;/height&gt;
+   &lt;/size&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot;&gt;
+   &lt;string&gt;Retenciones IRPF&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowIcon&quot;&gt;
+   &lt;iconset resource=&quot;../../../bulmages.qrc&quot;&gt;
+    &lt;normaloff&gt;:/Images/vattax.png&lt;/normaloff&gt;:/Images/vattax.png&lt;/iconset&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QGridLayout&quot;&gt;
+   &lt;property name=&quot;margin&quot;&gt;
+    &lt;number&gt;4&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;property name=&quot;spacing&quot;&gt;
+    &lt;number&gt;4&lt;/number&gt;
+   &lt;/property&gt;
+   &lt;item row=&quot;2&quot; column=&quot;0&quot;&gt;
+    &lt;layout class=&quot;QHBoxLayout&quot;&gt;
+     &lt;property name=&quot;spacing&quot;&gt;
+      &lt;number&gt;4&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;margin&quot;&gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot;&gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; stdset=&quot;0&quot;&gt;
+        &lt;size&gt;
+         &lt;width&gt;151&lt;/width&gt;
+         &lt;height&gt;27&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QPushButton&quot; name=&quot;mui_aceptar&quot;&gt;
+       &lt;property name=&quot;text&quot;&gt;
+        &lt;string&gt;&amp;Aceptar&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QPushButton&quot; name=&quot;mui_cancelar&quot;&gt;
+       &lt;property name=&quot;text&quot;&gt;
+        &lt;string&gt;&amp;Cancelar&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;0&quot; column=&quot;0&quot;&gt;
+    &lt;layout class=&quot;QHBoxLayout&quot;&gt;
+     &lt;property name=&quot;spacing&quot;&gt;
+      &lt;number&gt;4&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;margin&quot;&gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot;&gt;
+       &lt;property name=&quot;minimumSize&quot;&gt;
+        &lt;size&gt;
+         &lt;width&gt;48&lt;/width&gt;
+         &lt;height&gt;48&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;maximumSize&quot;&gt;
+        &lt;size&gt;
+         &lt;width&gt;48&lt;/width&gt;
+         &lt;height&gt;48&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;pixmap&quot;&gt;
+        &lt;pixmap resource=&quot;../../../bulmages.qrc&quot;&gt;:/Images/vattax.png&lt;/pixmap&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;scaledContents&quot;&gt;
+        &lt;bool&gt;true&lt;/bool&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QFrame&quot; name=&quot;frame&quot;&gt;
+       &lt;property name=&quot;sizePolicy&quot;&gt;
+        &lt;sizepolicy hsizetype=&quot;Expanding&quot; vsizetype=&quot;Preferred&quot;&gt;
+         &lt;horstretch&gt;0&lt;/horstretch&gt;
+         &lt;verstretch&gt;0&lt;/verstretch&gt;
+        &lt;/sizepolicy&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;frameShape&quot;&gt;
+        &lt;enum&gt;QFrame::StyledPanel&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;frameShadow&quot;&gt;
+        &lt;enum&gt;QFrame::Raised&lt;/enum&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;1&quot; column=&quot;0&quot;&gt;
+    &lt;widget class=&quot;ListIRPFSubForm&quot; name=&quot;mui_listado&quot;&gt;
+     &lt;property name=&quot;horizontalScrollMode&quot;&gt;
+      &lt;enum&gt;QAbstractItemView::ScrollPerPixel&lt;/enum&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;layoutdefault spacing=&quot;2&quot; margin=&quot;6&quot;/&gt;
+ &lt;customwidgets&gt;
+  &lt;customwidget&gt;
+   &lt;class&gt;ListIRPFSubForm&lt;/class&gt;
+   &lt;extends&gt;QTableWidget&lt;/extends&gt;
+   &lt;header&gt;listirpfview.h&lt;/header&gt;
+  &lt;/customwidget&gt;
+ &lt;/customwidgets&gt;
+ &lt;resources&gt;
+  &lt;include location=&quot;../../../bulmages.qrc&quot;/&gt;
+ &lt;/resources&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;mui_cancelar&lt;/sender&gt;
+   &lt;signal&gt;clicked()&lt;/signal&gt;
+   &lt;receiver&gt;ListIRPFBase&lt;/receiver&gt;
+   &lt;slot&gt;close()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot;&gt;
+     &lt;x&gt;311&lt;/x&gt;
+     &lt;y&gt;563&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot;&gt;
+     &lt;x&gt;6&lt;/x&gt;
+     &lt;y&gt;564&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+&lt;/ui&gt;
diff --git a/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.cpp b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.cpp
new file mode 100644
index 0000000..7492459
--- /dev/null
+++ b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.cpp
@@ -0,0 +1,111 @@
+/***************************************************************************
+ *   Copyright (C) 2004 by Tomeu Borras Riera                              *
+ *   <A HREF="https://lists.berlios.de/mailman/listinfo/bulmages-main">tborras en conetxia.com</A>                                                  *
+ *   Copyright (C) 2006 by Fco. Javier M. C. (Porting to QT4)              *
+ *   <A HREF="https://lists.berlios.de/mailman/listinfo/bulmages-main">fcojavmc en todo-redes.com</A>                                               *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#include &lt;fstream&gt;
+
+#include &lt;QMessageBox&gt;
+#include &lt;QWidget&gt;
+#include &lt;QComboBox&gt;
+#include &lt;QToolButton&gt;
+#include &lt;QTextStream&gt;
+#include &lt;QLayout&gt;
+#include &lt;QMessageBox&gt;
+
+#include &quot;listirpfview.h&quot;
+#include &quot;bfcompany.h&quot;
+#include &quot;blconfiguration.h&quot;
+#include &quot;bldatesearch.h&quot;
+#include &quot;blfunctions.h&quot;
+
+
+///
+/**
+\param comp
+\param parent
+**/
+ListIRPFView::ListIRPFView ( BfCompany *comp, QWidget *parent )
+        : BfForm ( comp, parent )
+{
+    BL_FUNC_DEBUG
+    setTitleName ( _ ( &quot;IRPF&quot; ) );
+    setDbTableName ( &quot;irpf&quot; );
+    setAttribute ( Qt::WA_DeleteOnClose );
+    setupUi ( this );
+    mui_listado-&gt;setMainCompany ( comp );
+    mui_listado-&gt;load();
+    insertWindow ( windowTitle(), this );
+    blScript(this);
+    
+}
+
+
+///
+/**
+**/
+void ListIRPFView::on_mui_aceptar_clicked()
+{
+    BL_FUNC_DEBUG
+    try {
+        mui_listado-&gt;save();
+        close();
+    } catch ( ... ) {
+        blMsgInfo ( _ ( &quot;Error al guardar los IRPFs&quot; ) );
+    } // end try
+    
+}
+
+
+ListIRPFView::~ListIRPFView()
+{
+    BL_FUNC_DEBUG
+    
+}
+
+
+/// ===================================== SUBFORMULARIO ===============================================
+///
+/**
+\param parent
+**/
+ListIRPFSubForm::ListIRPFSubForm ( QWidget *parent ) : BfSubForm ( parent )
+{
+    BL_FUNC_DEBUG
+    setDbTableName ( &quot;irpf&quot; );
+    setDbFieldId ( &quot;idirpf&quot; );
+    addSubFormHeader ( &quot;idirpf&quot;, BlDbField::DbInt, BlDbField::DbPrimaryKey, BlSubFormHeader::DbHideView, _ ( &quot;Id IRPF&quot; ) );
+    addSubFormHeader ( &quot;tasairpf&quot;, BlDbField::DbNumeric, BlDbField::DbNotNull, BlSubFormHeader::DbNone, _ ( &quot;Porcentaje IRPF&quot; ) );
+    addSubFormHeader ( &quot;fechairpf&quot;, BlDbField::DbDate, BlDbField::DbNotNull, BlSubFormHeader::DbNone, _ ( &quot;Fecha Entrada en Vigor&quot; ) );
+    setInsert ( TRUE );
+    
+}
+
+
+///
+/**
+**/
+void ListIRPFSubForm::load()
+{
+    BL_FUNC_DEBUG
+    BlSubForm::load ( &quot;SELECT * FROM irpf&quot; );
+    
+}
+
diff --git a/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.h b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.h
new file mode 100644
index 0000000..b52f8de
--- /dev/null
+++ b/bulmages/bulmafact/plugins/pluginbf_iva/listirpfview.h
@@ -0,0 +1,69 @@
+/***************************************************************************
+ *   Copyright (C) 2004 by Tomeu Borras Riera                              *
+ *   <A HREF="https://lists.berlios.de/mailman/listinfo/bulmages-main">tborras en conetxia.com</A>                                                  *
+ *   Copyright (C) 2006 by Fco. Javier M. C. (Porting to QT4)              *
+ *   <A HREF="https://lists.berlios.de/mailman/listinfo/bulmages-main">fcojavmc en todo-redes.com</A>                                               *
+ *   <A HREF="http://www.iglues.org">http://www.iglues.org</A>                                                 *
+ *                                                                         *
+ *   This program is free software; you can redistribute it and/or modify  *
+ *   it under the terms of the GNU General Public License as published by  *
+ *   the Free Software Foundation; either version 2 of the License, or     *
+ *   (at your option) any later version.                                   *
+ *                                                                         *
+ *   This program is distributed in the hope that it will be useful,       *
+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
+ *   GNU General Public License for more details.                          *
+ *                                                                         *
+ *   You should have received a copy of the GNU General Public License     *
+ *   along with this program; if not, write to the                         *
+ *   Free Software Foundation, Inc.,                                       *
+ *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
+ ***************************************************************************/
+
+#ifndef LISTIRPFVIEW_H
+#define LISTIRPFVIEW_H
+
+#include &lt;QLineEdit&gt;
+#include &lt;QLabel&gt;
+#include &lt;QCheckBox&gt;
+
+#include &quot;blpostgresqlclient.h&quot;
+#include &quot;bldatesearch.h&quot;
+#include &quot;bfsubform.h&quot;
+#include &quot;bfform.h&quot;
+
+
+/// Muestra y administra las l&iacute;neas de detalle del listado de tasas de IVA.
+/** */
+class ListIRPFSubForm : public BfSubForm
+{
+    Q_OBJECT
+
+public:
+    ListIRPFSubForm ( QWidget *parent = 0 );
+    virtual ~ListIRPFSubForm() {};
+
+public slots:
+    virtual void load();
+};
+
+
+#include &quot;ui_listirpfbase.h&quot;
+
+
+/// Muestra y administra el listado de tasas de IVA.
+/** */
+class ListIRPFView : public BfForm, public Ui_ListIRPFBase
+{
+    Q_OBJECT
+
+public:
+    ListIRPFView ( BfCompany *comp, QWidget *parent );
+    ~ListIRPFView();
+
+public slots:
+    virtual void on_mui_aceptar_clicked();
+};
+
+#endif
diff --git a/bulmages/bulmafact/plugins/pluginbf_iva/pluginbf_iva.cpp b/bulmages/bulmafact/plugins/pluginbf_iva/pluginbf_iva.cpp
index 0fe7c11..a64712e 100644
--- a/bulmages/bulmafact/plugins/pluginbf_iva/pluginbf_iva.cpp
+++ b/bulmages/bulmafact/plugins/pluginbf_iva/pluginbf_iva.cpp
@@ -25,6 +25,7 @@
 #include &quot;blfunctions.h&quot;
 #include &quot;listtipoivaview.h&quot;
 #include &quot;listtasaivaview.h&quot;
+#include &quot;listirpfview.h&quot;
 
 
 BfBulmaFact *g_pluginbf_iva = NULL;
@@ -72,6 +73,16 @@ int entryPoint ( BfBulmaFact *bges )
         pPluginMenu-&gt;addAction ( accionB );
         bges-&gt;Listados-&gt;addAction ( accionB );
 
+        /// Menu para tratar los IRPF's y discriminarlos por fechas.
+        BlAction *accionC = new BlAction ( _ ( &quot;&amp;Retenciones IRPF&quot; ), 0 );
+        accionC-&gt;setIcon ( QIcon ( QString::fromUtf8 ( &quot;:/Images/vattax.png&quot; ) ) );
+        accionC-&gt;setStatusTip ( _ ( &quot;Retenciones IRPF&quot; ) );
+        accionC-&gt;setWhatsThis ( _ ( &quot;Retenciones IRPF&quot; ) );
+        accionC-&gt;setObjectName(&quot;mui_actionIRPF&quot;);
+        pPluginMenu-&gt;addAction ( accionC );
+        bges-&gt;Listados-&gt;addAction ( accionC );
+	
+	
     } // end if
     return 0;
 }
@@ -92,6 +103,11 @@ int BlAction_actionTriggered(BlAction *accion) {
          pag-&gt;show();
     } // end if
 
+    if (accion-&gt;objectName() == &quot;mui_actionIRPF&quot;) {
+         ListIRPFView *pag = new ListIRPFView ( g_pluginbf_iva-&gt;company(), NULL );
+         g_pluginbf_iva-&gt;company()-&gt;m_pWorkspace-&gt;addSubWindow ( pag );
+         pag-&gt;show();
+    } // end if
     
     return 0;
 }
diff --git a/bulmages/bulmafact/src/bfform.cpp b/bulmages/bulmafact/src/bfform.cpp
index 68f0254..cc11b50 100644
--- a/bulmages/bulmafact/src/bfform.cpp
+++ b/bulmages/bulmafact/src/bfform.cpp
@@ -89,17 +89,24 @@ void BfForm::calculaypintatotales()
     QString l;
     BlFixed irpf ( &quot;0&quot; );
 
-    BlDbRecordSet *cur = mainCompany() -&gt;loadQuery ( &quot;SELECT * FROM configuracion WHERE nombre = 'IRPF'&quot; );
-    
-    if ( cur ) {
-        if ( !cur-&gt;eof() ) {
-            irpf = BlFixed ( cur-&gt;value( &quot;valor&quot; ) );
-        } // end if
-        delete cur;
+    /// El calculo del IRPF basandonos en la fecha.
+    QString campfecha = &quot;fecha&quot; +  tableName();
+    if (!exists(campfecha)) 
+      campfecha = &quot;f&quot; + tableName();
+    if (exists(campfecha)) {
+        QString query = &quot;SELECT tasairpf FROM irpf WHERE fechairpf &lt;= &quot;+QString (dbValue(campfecha)==&quot;&quot; ? &quot;now()&quot; : &quot;'&quot; + dbValue(campfecha) +&quot;'::DATE&quot;) + &quot; AND tasairpf &gt; 0 ORDER BY fechairpf DESC LIMIT 1&quot;;
+	BlDbRecordSet *cur = mainCompany() -&gt;loadQuery ( query);
+	if ( cur ) {
+	    if ( !cur-&gt;eof() ) {
+		irpf = BlFixed ( cur-&gt;value( &quot;tasairpf&quot; ) );
+	    } // end if
+	    delete cur;
+	} // end if
     } // end if
 
+
     if ( exists ( &quot;idproveedor&quot; ) &amp;&amp; dbValue ( &quot;idproveedor&quot; ) != &quot;&quot; ) {
-        cur = mainCompany() -&gt;loadQuery ( &quot;SELECT irpfproveedor FROM proveedor WHERE idproveedor = &quot; + dbValue ( &quot;idproveedor&quot; ) );
+        BlDbRecordSet *cur = mainCompany() -&gt;loadQuery ( &quot;SELECT irpfproveedor FROM proveedor WHERE idproveedor = &quot; + dbValue ( &quot;idproveedor&quot; ) );
         if ( cur ) {
             if ( !cur-&gt;eof() ) {
                 irpf = BlFixed ( cur-&gt;value( &quot;irpfproveedor&quot; ) );
diff --git a/bulmages/bulmafact/src/main.cxx b/bulmages/bulmafact/src/main.cxx
index af59086..a89c183 100644
--- a/bulmages/bulmafact/src/main.cxx
+++ b/bulmages/bulmafact/src/main.cxx
@@ -129,7 +129,7 @@ int main ( int argc, char **argv )
       delete argParser;
 
       /// Verifica la version de la base de datos para funcionar adecuadamente.
-      bges-&gt;company()-&gt;dbVersionCheck(&quot;DatabaseRevision&quot;, &quot;0.14.1-0001&quot;);
+      bges-&gt;company()-&gt;dbVersionCheck(&quot;DatabaseRevision&quot;, &quot;0.14.1-0002&quot;);
 
 
       splashScr-&gt;show();
diff --git a/bulmages/installbulmages/dbmodels/actualizar/revf-0.14.sql b/bulmages/installbulmages/dbmodels/actualizar/revf-0.14.sql
index 8ea8a6b..e121d62 100644
--- a/bulmages/installbulmages/dbmodels/actualizar/revf-0.14.sql
+++ b/bulmages/installbulmages/dbmodels/actualizar/revf-0.14.sql
@@ -77,6 +77,236 @@ DROP FUNCTION compruebarevision() CASCADE;
 
 -- ================================== ACTUALIZACION  ===================================
 
+-- Creamos la tabla de gestion de IRPF
+\echo -n ':: Creamos la tabla de gestion de IRPF '
+CREATE OR REPLACE FUNCTION aux() RETURNS INTEGER AS '
+DECLARE
+    rs RECORD;
+BEGIN
+
+    SELECT INTO rs * FROM pg_tables WHERE tablename=''irpf'';
+    IF NOT FOUND THEN
+	CREATE TABLE irpf (
+	    idirpf serial PRIMARY KEY,
+	    fechairpf date NOT NULL,
+	    tasairpf  numeric(12,2)
+	);
+
+    END IF;
+
+    DELETE FROM configuracion WHERE nombre=''IRPF'';
+
+   RETURN 0;
+END;
+' LANGUAGE plpgsql;
+SELECT aux();
+DROP FUNCTION aux() CASCADE;
+
+
+
+\echo -n ':: Funcion que calcula el total de una factura ... '
+CREATE OR REPLACE FUNCTION calctotalfactura(integer) RETURNS numeric(12, 2)
+AS '
+DECLARE
+    idp ALIAS FOR $1;
+    totalBImponibleLineas numeric(12, 2);
+    totalIRPF numeric(12, 2);
+    totalIVA numeric(12, 2);
+    totalRE numeric(12, 2);
+    totalTotal numeric(12, 2);
+    rs RECORD;
+
+BEGIN
+    totalBImponibleLineas := 0;
+    totalIRPF := 0;
+    totalIVA := 0;
+    totalRE := 0;
+    totalTotal := 0;
+
+    FOR rs IN SELECT cantlfactura * pvplfactura * (1 - descuentolfactura / 100) AS subtotal1 FROM lfactura WHERE idfactura = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
+    END LOOP;
+
+
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT ffactura FROM factura WHERE idfactura = idp) ORDER BY fechairpf DESC LIMIT 1;
+    IF FOUND THEN
+        totalIRPF := totalBImponibleLineas * (rs.tasairpf / 100);
+    END IF;
+
+    FOR rs IN SELECT cantlfactura * pvplfactura * (1 - descuentolfactura / 100) * (ivalfactura / 100) AS subtotal1 FROM lfactura WHERE idfactura = idp LOOP
+	totalIVA := totalIVA + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT cantlfactura * pvplfactura * (1 - descuentolfactura / 100) * (reqeqlfactura / 100) AS subtotal1 FROM lfactura WHERE idfactura = idp LOOP
+	totalRE := totalRE + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT proporciondfactura FROM dfactura WHERE idfactura = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas * (1 - rs.proporciondfactura / 100);
+	totalIRPF := totalIRPF * (1 - rs.proporciondfactura / 100);
+	totalIVA := totalIVA * (1 - rs.proporciondfactura / 100);
+	totalRE := totalRE * (1 - rs.proporciondfactura / 100);
+    END LOOP;
+
+    totalTotal = totalBImponibleLineas - totalIRPF + totalIVA + totalRE;
+
+    RETURN totalTotal;
+END;
+' LANGUAGE plpgsql;
+
+
+
+\echo -n ':: Funcion que calcula el total de un presupuesto a cliente ... '
+CREATE OR REPLACE FUNCTION calctotalpres(integer) RETURNS numeric(12, 2)
+AS '
+DECLARE
+    idp ALIAS FOR $1;
+    totalBImponibleLineas numeric(12, 2);
+    totalIRPF numeric(12, 2);
+    totalIVA numeric(12, 2);
+    totalRE numeric(12, 2);
+    totalTotal numeric(12, 2);
+    rs RECORD;
+    rs2 RECORD;
+
+BEGIN
+    totalBImponibleLineas := 0;
+    totalIRPF := 0;
+    totalIVA := 0;
+    totalRE := 0;
+    totalTotal := 0;
+
+    FOR rs IN SELECT cantlpresupuesto * pvplpresupuesto * (1 - descuentolpresupuesto / 100) AS subtotal1 FROM lpresupuesto WHERE idpresupuesto = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
+    END LOOP;
+
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fpresupuesto FROM presupuesto WHERE idpresupuesto = idp) ORDER BY fechairpf DESC LIMIT 1;
+    IF FOUND THEN
+        totalIRPF := totalBImponibleLineas * (rs.tasairpf / 100);
+    END IF;
+
+    FOR rs IN SELECT cantlpresupuesto * pvplpresupuesto * (1 - descuentolpresupuesto / 100) * (ivalpresupuesto / 100) AS subtotal1 FROM lpresupuesto WHERE idpresupuesto = idp LOOP
+	totalIVA := totalIVA + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT cantlpresupuesto * pvplpresupuesto * (1 - descuentolpresupuesto / 100) * (reqeqlpresupuesto / 100) AS subtotal1 FROM lpresupuesto WHERE idpresupuesto = idp LOOP
+	totalRE := totalRE + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT proporciondpresupuesto FROM dpresupuesto WHERE idpresupuesto = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas * (1 - rs.proporciondpresupuesto / 100);
+	totalIRPF := totalIRPF * (1 - rs.proporciondpresupuesto / 100);
+	totalIVA := totalIVA * (1 - rs.proporciondpresupuesto / 100);
+	totalRE := totalRE * (1 - rs.proporciondpresupuesto / 100);
+    END LOOP;
+
+    totalTotal = totalBImponibleLineas - totalIRPF + totalIVA + totalRE;
+
+    RETURN totalTotal;
+END;
+' LANGUAGE plpgsql;
+
+
+\echo -n ':: Funcion que calcula el total de un pedido de cliente ... '
+CREATE OR REPLACE FUNCTION calctotalpedcli(integer) RETURNS numeric(12, 2)
+AS '
+DECLARE
+    idp ALIAS FOR $1;
+    totalBImponibleLineas numeric(12, 2);
+    totalIRPF numeric(12, 2);
+    totalIVA numeric(12, 2);
+    totalRE numeric(12, 2);
+    totalTotal numeric(12, 2);
+    rs RECORD;
+    rs2 RECORD;
+
+BEGIN
+    totalBImponibleLineas := 0;
+    totalIRPF := 0;
+    totalIVA := 0;
+    totalRE := 0;
+    totalTotal := 0;
+
+    FOR rs IN SELECT cantlpedidocliente * pvplpedidocliente * (1 - descuentolpedidocliente / 100) AS subtotal1 FROM lpedidocliente WHERE idpedidocliente = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
+    END LOOP;
+
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fechapedidocliente FROM pedidocliente WHERE idpedidocliente = idp) ORDER BY fechairpf DESC LIMIT 1;
+    IF FOUND THEN
+        totalIRPF := totalBImponibleLineas * (rs.tasairpf / 100);
+    END IF;
+
+    FOR rs IN SELECT cantlpedidocliente * pvplpedidocliente * (1 - descuentolpedidocliente / 100) * (ivalpedidocliente / 100) AS subtotal1 FROM lpedidocliente WHERE idpedidocliente = idp LOOP
+	totalIVA := totalIVA + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT cantlpedidocliente * pvplpedidocliente * (1 - descuentolpedidocliente / 100) * (reqeqlpedidocliente / 100) AS subtotal1 FROM lpedidocliente WHERE idpedidocliente = idp LOOP
+	totalRE := totalRE + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT proporciondpedidocliente FROM dpedidocliente WHERE idpedidocliente = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas * (1 - rs.proporciondpedidocliente / 100);
+	totalIRPF := totalIRPF * (1 - rs.proporciondpedidocliente / 100);
+	totalIVA := totalIVA * (1 - rs.proporciondpedidocliente / 100);
+	totalRE := totalRE * (1 - rs.proporciondpedidocliente / 100);
+    END LOOP;
+
+    totalTotal = totalBImponibleLineas - totalIRPF + totalIVA + totalRE;
+
+    RETURN totalTotal;
+END;
+' LANGUAGE plpgsql;
+
+
+\echo -n ':: Funcion que calcula el total de un albaran a cliente ... '
+CREATE OR REPLACE FUNCTION calctotalalbaran(integer) RETURNS numeric(12, 2)
+AS '
+DECLARE
+    idp ALIAS FOR $1;
+    totalBImponibleLineas numeric(12, 2);
+    totalIRPF numeric(12, 2);
+    totalIVA numeric(12, 2);
+    totalRE numeric(12, 2);
+    totalTotal numeric(12, 2);
+    rs RECORD;
+    rs2 RECORD;
+
+BEGIN
+    totalBImponibleLineas := 0;
+    totalIRPF := 0;
+    totalIVA := 0;
+    totalRE := 0;
+    totalTotal := 0;
+
+    FOR rs IN SELECT cantlalbaran * pvplalbaran * (1 - descuentolalbaran / 100) AS subtotal1 FROM lalbaran WHERE idalbaran = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
+    END LOOP;
+
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fechaalbaran FROM albaran WHERE idalbaran = idp) ORDER BY fechairpf DESC LIMIT 1;
+    IF FOUND THEN
+        totalIRPF := totalBImponibleLineas * (rs.tasairpf / 100);
+    END IF;
+
+    FOR rs IN SELECT cantlalbaran * pvplalbaran * (1 - descuentolalbaran / 100) * (ivalalbaran / 100) AS subtotal1 FROM lalbaran WHERE idalbaran = idp LOOP
+	totalIVA := totalIVA + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT cantlalbaran * pvplalbaran * (1 - descuentolalbaran / 100) * (reqeqlalbaran / 100) AS subtotal1 FROM lalbaran WHERE idalbaran = idp LOOP
+	totalRE := totalRE + rs.subtotal1;
+    END LOOP;
+
+    FOR rs IN SELECT proporciondalbaran FROM dalbaran WHERE idalbaran = idp LOOP
+	totalBImponibleLineas := totalBImponibleLineas * (1 - rs.proporciondalbaran / 100);
+	totalIRPF := totalIRPF * (1 - rs.proporciondalbaran / 100);
+	totalIVA := totalIVA * (1 - rs.proporciondalbaran / 100);
+	totalRE := totalRE * (1 - rs.proporciondalbaran / 100);
+    END LOOP;
+
+    totalTotal = totalBImponibleLineas - totalIRPF + totalIVA + totalRE;
+
+    RETURN totalTotal;
+END;
+' LANGUAGE plpgsql;
 
 
 -- =====================================================================================
@@ -89,16 +319,16 @@ DECLARE
 BEGIN
 	SELECT INTO rs * FROM configuracion WHERE nombre = ''DatabaseRevision'';
 	IF FOUND THEN
-		UPDATE CONFIGURACION SET valor = ''0.14.1-0001'' WHERE nombre = ''DatabaseRevision'';
+		UPDATE CONFIGURACION SET valor = ''0.14.1-0002'' WHERE nombre = ''DatabaseRevision'';
 	ELSE
-		INSERT INTO configuracion (nombre, valor) VALUES (''DatabaseRevision'', ''0.14.1-0001'');
+		INSERT INTO configuracion (nombre, valor) VALUES (''DatabaseRevision'', ''0.14.1-0002'');
 	END IF;
 	RETURN 0;
 END;
 '   LANGUAGE plpgsql;
 SELECT actualizarevision();
 DROP FUNCTION actualizarevision() CASCADE;
-\echo &quot;Actualizada la revision de la base de datos a la version 0.14.1&quot;
+\echo &quot;Actualizada la revision de la base de datos a la version 0.14.2&quot;
 
 DROP FUNCTION drop_if_exists_table(text) CASCADE;
 DROP FUNCTION drop_if_exists_proc(text, text) CASCADE;
diff --git a/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_data.sql b/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_data.sql
index a17d445..af918b8 100644
--- a/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_data.sql
+++ b/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_data.sql
@@ -47,7 +47,6 @@ INSERT INTO configuracion (nombre, valor) VALUES ('DireccionCompleta', 'Sin defi
 INSERT INTO configuracion (nombre, valor) VALUES ('Ciudad', 'Sin definir');
 INSERT INTO configuracion (nombre, valor) VALUES ('CodArticuloGenerico', 'Sin Definir');
 INSERT INTO configuracion (nombre, valor) VALUES ('SerieFacturaDefecto', '**CAMBIAME**');
-INSERT INTO configuracion (nombre, valor) VALUES ('IRPF', '0');
 INSERT INTO configuracion (nombre, valor) VALUES ('CodCuenta', 'xxxxyyy');
 \echo -n ':: Configuraciones ... '
 COMMIT;
diff --git a/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_schema.sql b/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_schema.sql
index 1eeeb5b..b51640e 100644
--- a/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_schema.sql
+++ b/bulmages/installbulmages/dbmodels/crear/bulmafact/bulmafact_schema.sql
@@ -274,6 +274,14 @@ CREATE TABLE tasa_iva (
 );
 
 
+\echo -n ':: IRPF ... '
+CREATE TABLE irpf (
+    idirpf serial PRIMARY KEY,
+    fechairpf date NOT NULL,
+    tasairpf  numeric(12,2)
+);
+
+
 -- ** serie_factura **
 -- Tabla con series de IVA, codigo y descripcion.
 -- Basicamente sirve para garantizar la integridad referencial en las series de facturacion.
@@ -1481,8 +1489,7 @@ BEGIN
 	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
     END LOOP;
 
-    SELECT INTO rs valor::numeric FROM configuracion WHERE LOWER(nombre) = ''irpf'';
-
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT ffactura FROM factura WHERE idfactura = idp) ORDER BY fechairpf DESC LIMIT 1;
     IF FOUND THEN
         totalIRPF := totalBImponibleLineas * (rs.valor / 100);
     END IF;
@@ -2888,8 +2895,7 @@ BEGIN
 	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
     END LOOP;
 
-    SELECT INTO rs valor::numeric FROM configuracion WHERE LOWER(nombre) = ''irpf'';
-
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fpresupuesto FROM presupuesto WHERE idpresupuesto = idp) ORDER BY fechairpf DESC LIMIT 1;
     IF FOUND THEN
         totalIRPF := totalBImponibleLineas * (rs.valor / 100);
     END IF;
@@ -2988,8 +2994,7 @@ BEGIN
 	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
     END LOOP;
 
-    SELECT INTO rs valor::numeric FROM configuracion WHERE LOWER(nombre) = ''irpf'';
-
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fechapedidocliente FROM pedidocliente WHERE idpedidocliente = idp) ORDER BY fechairpf DESC LIMIT 1;
     IF FOUND THEN
         totalIRPF := totalBImponibleLineas * (rs.valor / 100);
     END IF;
@@ -3088,8 +3093,7 @@ BEGIN
 	totalBImponibleLineas := totalBImponibleLineas + rs.subtotal1;
     END LOOP;
 
-    SELECT INTO rs valor::numeric FROM configuracion WHERE LOWER(nombre) = ''irpf'';
-
+    SELECT INTO rs tasairpf FROM irpf WHERE fechairpf &lt;= (SELECT fechaalbaran FROM albaran WHERE idalbaran = idp) ORDER BY fechairpf DESC LIMIT 1;
     IF FOUND THEN
         totalIRPF := totalBImponibleLineas * (rs.valor / 100);
     END IF;
@@ -3295,9 +3299,9 @@ BEGIN
     SELECT INTO rs * FROM configuracion WHERE nombre = ''DatabaseRevision'';
 
     IF FOUND THEN
-	UPDATE CONFIGURACION SET valor = ''0.14.1-0001'' WHERE nombre = ''DatabaseRevision'';
+	UPDATE CONFIGURACION SET valor = ''0.14.1-0002'' WHERE nombre = ''DatabaseRevision'';
     ELSE
-	INSERT INTO configuracion (nombre, valor) VALUES (''DatabaseRevision'', ''0.14.1-0001'');
+	INSERT INTO configuracion (nombre, valor) VALUES (''DatabaseRevision'', ''0.14.1-0002'');
     END IF;
 
     RETURN 0;


<A HREF="https://gitorious.org/bulmages">https://gitorious.org/bulmages</A>
------------------------------------------------------------------------

You are receiving this email because you have chosen to be notified by
email whenever this favorite has new activity. You can manage your
favorite subscriptions at <A HREF="https://gitorious.org/favorites">https://gitorious.org/favorites</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Mensaje anterior: <A HREF="007411.html">[BulmaGés][BulmaGés - Solicitud #5] (Nueva) OOolib ya no existe en las distribuciones
</A></li>
	<LI>Próximo mensaje: <A HREF="007415.html">[BulmaGés]Algunas propuestas
</A></li>
         <LI> <B>Mensajes ordenados por:</B> 
              <a href="date.html#7412">[ fecha ]</a>
              <a href="thread.html#7412">[ hilo ]</a>
              <a href="subject.html#7412">[ asunto ]</a>
              <a href="author.html#7412">[ autor ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/bulmages-main">Más información sobre la lista de distribución Bulmages-main </a><br>
</body></html>
